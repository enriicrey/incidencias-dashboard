<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard T√©cnico - Sistema de Incidencias</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        
        .container {
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
            max-width: 800px;
            width: 100%;
            animation: slideIn 0.5s ease-out;
        }
        
        @keyframes slideIn {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .header {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 30px;
            text-align: center;
        }
        
        .incident-id {
            font-size: 32px;
            font-weight: 700;
            margin-bottom: 10px;
            letter-spacing: -1px;
        }
        
        .priority-badge {
            display: inline-block;
            padding: 8px 16px;
            border-radius: 20px;
            font-weight: 600;
            font-size: 14px;
            margin-top: 10px;
        }
        
        .priority-critical { background: #dc3545; color: white; }
        .priority-high { background: #fd7e14; color: white; }
        .priority-medium { background: #ffc107; color: #212529; }
        .priority-low { background: #28a745; color: white; }
        
        .content {
            padding: 40px;
        }
        
        .incident-details {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 30px;
        }
        
        .detail-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 15px;
            align-items: center;
        }
        
        .detail-label {
            font-weight: 600;
            color: #495057;
            min-width: 140px;
        }
        
        .detail-value {
            color: #212529;
            flex: 1;
            text-align: right;
        }
        
        .description-box {
            background: #e7f1ff;
            border: 2px solid #0066cc;
            border-radius: 12px;
            padding: 20px;
            margin: 25px 0;
        }
        
        .timer-container {
            background: linear-gradient(135deg, #ff6b6b, #ee5a24);
            color: white;
            text-align: center;
            padding: 20px;
            border-radius: 12px;
            margin: 25px 0;
        }
        
        .timer {
            font-size: 36px;
            font-weight: 700;
            margin-bottom: 10px;
        }
        
        .actions {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-top: 30px;
        }
        
        .btn {
            padding: 18px 25px;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            text-align: center;
            display: block;
        }
        
        .btn-accept {
            background: linear-gradient(135deg, #28a745, #20c997);
            color: white;
            grid-column: span 2;
        }
        
        .btn-reject {
            background: linear-gradient(135deg, #dc3545, #c82333);
            color: white;
        }
        
        .btn-help {
            background: linear-gradient(135deg, #ffc107, #e0a800);
            color: #212529;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.2);
        }
        
        .contact-info {
            background: #d1ecf1;
            border-radius: 12px;
            padding: 20px;
            margin: 25px 0;
        }
        
        .contact-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 15px;
        }
        
        .contact-item {
            text-align: center;
        }
        
        .contact-phone {
            color: #17a2b8;
            text-decoration: none;
            font-weight: 600;
            font-size: 18px;
        }
        
        .status-indicator {
            position: absolute;
            top: 20px;
            right: 20px;
            width: 12px;
            height: 12px;
            background: #28a745;
            border-radius: 50%;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(40, 167, 69, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(40, 167, 69, 0); }
            100% { box-shadow: 0 0 0 0 rgba(40, 167, 69, 0); }
        }
        
        .breadcrumb {
            background: #f8f9fa;
            padding: 15px 25px;
            border-bottom: 1px solid #dee2e6;
            font-size: 14px;
            color: #6c757d;
        }
        
        .reason-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }
        
        .reason-modal-content {
            background: white;
            border-radius: 16px;
            padding: 30px;
            max-width: 500px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
        }
        
        .reason-options {
            margin: 20px 0;
        }
        
        .reason-option {
            padding: 15px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            margin-bottom: 10px;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .reason-option:hover {
            border-color: #007bff;
            background: #f8f9fa;
        }
        
        .reason-option.selected {
            border-color: #007bff;
            background: #e7f1ff;
        }
        
        .reason-option .icon {
            font-size: 20px;
            width: 30px;
            text-align: center;
        }
        
        .reason-option .text {
            flex: 1;
        }
        
        .reason-option .title {
            font-weight: 600;
            margin-bottom: 4px;
        }
        
        .reason-option .description {
            font-size: 14px;
            color: #6c757d;
        }
        
        .reason-actions {
            display: flex;
            gap: 10px;
            margin-top: 25px;
        }
        
        .reason-actions .btn {
            flex: 1;
            margin: 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="status-indicator"></div>
        
        <div class="breadcrumb">
            üìß Llegaste desde: Correo de Asignaci√≥n ‚Üí üéØ Acci√≥n Requerida
        </div>
        
        <div class="header">
            <div class="incident-id" id="incidentId">INC-20/08-00045-CR√çTICA-ZNA-MT12</div>
            <div>Nueva Incidencia Asignada</div>
            <div class="priority-badge priority-critical">üî¥ CR√çTICA</div>
        </div>
        
        <div class="content">
            <div class="timer-container">
                <div class="timer" id="countdown">05:00</div>
                <div>Tiempo restante para responder</div>
                <div style="font-size: 14px; opacity: 0.9; margin-top: 5px;">
                    Si no respondes, se escalar√° autom√°ticamente
                </div>
            </div>
            
            <div class="incident-details">
                <h3 style="margin-bottom: 20px; color: #2c3e50;">üìã Detalles de la Incidencia</h3>
                
                <div class="detail-row">
                    <span class="detail-label">üè¢ Equipo:</span>
                    <span class="detail-value">Compresor Principal #3</span>
                </div>
                
                <div class="detail-row">
                    <span class="detail-label">üìç Zona:</span>
                    <span class="detail-value">L√≠nea Norte A - Sector MT12</span>
                </div>
                
                <div class="detail-row">
                    <span class="detail-label">‚è∞ Reportada:</span>
                    <span class="detail-value">Hoy 14:23</span>
                </div>
                
                <div class="detail-row">
                    <span class="detail-label">üë§ Report√≥:</span>
                    <span class="detail-value">Carlos Mendoza</span>
                </div>
            </div>
            
            <div class="description-box">
                <h4 style="margin-bottom: 15px; color: #0066cc;">üîß Descripci√≥n del Problema</h4>
                <p style="line-height: 1.6;">
                    El compresor principal presenta ruidos an√≥malos y vibraciones excesivas. 
                    Se detecta presi√≥n irregular en el sistema hidr√°ulico. Requiere revisi√≥n 
                    inmediata para evitar parada de l√≠nea.
                </p>
            </div>
            
            <div class="contact-info">
                <h4 style="text-align: center; color: #0c5460; margin-bottom: 10px;">
                    üìû Contactos de Apoyo
                </h4>
                <div class="contact-grid">
                    <div class="contact-item">
                        <strong style="color: #0c5460;">Encargado de Zona</strong><br>
                        <span style="color: #495057;">Mar√≠a Gonz√°lez</span><br>
                        <a href="tel:+34600123456" class="contact-phone">+34 600 123 456</a>
                    </div>
                    <div class="contact-item">
                        <strong style="color: #0c5460;">Supervisor</strong><br>
                        <span style="color: #495057;">Elena V√°zquez</span><br>
                        <a href="tel:+34600789012" class="contact-phone">+34 600 789 012</a>
                    </div>
                </div>
            </div>
            
            <div class="actions">
                <a href="#" class="btn btn-accept" onclick="handleResponse('acepto')">
                    ‚úÖ ACEPTO LA INCIDENCIA
                </a>
                
                <a href="#" class="btn btn-reject" onclick="showReasonModal('rechazo')">
                    ‚ùå NO PUEDO HACERME CARGO
                </a>
                
                <a href="#" class="btn btn-help" onclick="showReasonModal('ayuda')">
                    üÜò NECESITO AYUDA
                </a>
            </div>
            
            <!-- Modal para motivos -->
            <div class="reason-modal" id="reasonModal">
                <div class="reason-modal-content">
                    <h3 id="reasonTitle">Selecciona el motivo</h3>
                    <div class="reason-options" id="reasonOptions">
                        <!-- Se llenar√° din√°micamente -->
                    </div>
                    <div class="reason-actions">
                        <button class="btn btn-success" onclick="confirmReason()" id="confirmReasonBtn">
                            ‚úÖ CONFIRMAR
                        </button>
                        <button class="btn" onclick="closeReasonModal()" style="background: #6c757d; color: white;">
                            ‚ùå CANCELAR
                        </button>
                    </div>
                </div>
            </div>
            
            <div style="text-align: center; margin-top: 30px; padding: 20px; background: #f8f9fa; border-radius: 12px;">
                <small style="color: #6c757d;">
                    <strong>Sistema de Incidencias</strong> - Respuesta T√©cnica L0<br>
                    Autenticaci√≥n autom√°tica desde correo
                </small>
            </div>
        </div>
    </div>
    
    <script>
        let currentAction = null;
        let selectedReason = null;
        
        // Motivos de rechazo
        const rejectReasons = [
            {
                id: 'ocupado_otra',
                icon: 'üîß',
                title: 'Ocupado con otra incidencia',
                description: 'Ya estoy resolviendo otra incidencia cr√≠tica'
            },
            {
                id: 'fuera_especialidad',
                icon: '‚ùì',
                title: 'Fuera de mi especialidad',
                description: 'No tengo experiencia con este tipo de equipo'
            },
            {
                id: 'no_disponible',
                icon: '‚è∞',
                title: 'No disponible ahora',
                description: 'Estoy en pausa, reuni√≥n o fuera de turno'
            },
            {
                id: 'falta_herramientas',
                icon: 'üî®',
                title: 'Faltan herramientas/repuestos',
                description: 'No tengo las herramientas necesarias disponibles'
            },
            {
                id: 'ubicacion_lejos',
                icon: 'üìç',
                title: 'Muy lejos de mi ubicaci√≥n',
                description: 'Estoy muy lejos de la zona de la incidencia'
            },
            {
                id: 'sobrecarga_trabajo',
                icon: '‚ö°',
                title: 'Sobrecarga de trabajo',
                description: 'Ya tengo demasiadas incidencias asignadas'
            }
        ];
        
        // Motivos de ayuda
        const helpReasons = [
            {
                id: 'apoyo_tecnico',
                icon: 'üë•',
                title: 'Necesito apoyo t√©cnico',
                description: 'Requiero asistencia de otro t√©cnico especializado'
            },
            {
                id: 'consulta_supervisor',
                icon: 'üéØ',
                title: 'Consulta con supervisor',
                description: 'Necesito autorizaci√≥n o gu√≠a del supervisor'
            },
            {
                id: 'herramientas_especiales',
                icon: 'üîß',
                title: 'Herramientas especiales',
                description: 'Requiero herramientas que no tengo disponibles'
            },
            {
                id: 'procedimiento_dudas',
                icon: 'üìã',
                title: 'Dudas sobre procedimiento',
                description: 'No estoy seguro del procedimiento correcto'
            },
            {
                id: 'seguridad_riesgo',
                icon: '‚ö†Ô∏è',
                title: 'Problema de seguridad',
                description: 'Hay riesgos de seguridad que requieren supervisi√≥n'
            },
            {
                id: 'repuestos_urgentes',
                icon: 'üì¶',
                title: 'Repuestos urgentes',
                description: 'Necesito repuestos que debo solicitar'
            }
        ];
        
        // Simular countdown
        let timeLeft = 300; // 5 minutos
        const countdownElement = document.getElementById('countdown');
        
        function updateCountdown() {
            const minutes = Math.floor(timeLeft / 60);
            const seconds = timeLeft % 60;
            countdownElement.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            
            if (timeLeft <= 60) {
                countdownElement.parentElement.style.background = 'linear-gradient(135deg, #dc3545, #c82333)';
            }
            
            if (timeLeft > 0) {
                timeLeft--;
                setTimeout(updateCountdown, 1000);
            } else {
                countdownElement.textContent = '‚è∞ TIEMPO AGOTADO';
                document.querySelector('.actions').innerHTML = '<div style="text-align: center; color: #dc3545; font-weight: 600;">La incidencia ha sido escalada autom√°ticamente</div>';
            }
        }
        
        updateCountdown();
        
        function showReasonModal(action) {
            currentAction = action;
            const modal = document.getElementById('reasonModal');
            const title = document.getElementById('reasonTitle');
            const optionsContainer = document.getElementById('reasonOptions');
            
            // Configurar t√≠tulo y opciones seg√∫n la acci√≥n
            if (action === 'rechazo') {
                title.textContent = '‚ùå ¬øPor qu√© no puedes hacerte cargo?';
                renderReasons(rejectReasons, optionsContainer);
            } else if (action === 'ayuda') {
                title.textContent = 'üÜò ¬øQu√© tipo de ayuda necesitas?';
                renderReasons(helpReasons, optionsContainer);
            }
            
            modal.style.display = 'flex';
        }
        
        function renderReasons(reasons, container) {
            container.innerHTML = '';
            reasons.forEach(reason => {
                const optionDiv = document.createElement('div');
                optionDiv.className = 'reason-option';
                optionDiv.onclick = () => selectReason(optionDiv, reason.id);
                
                optionDiv.innerHTML = `
                    <div class="icon">${reason.icon}</div>
                    <div class="text">
                        <div class="title">${reason.title}</div>
                        <div class="description">${reason.description}</div>
                    </div>
                `;
                
                container.appendChild(optionDiv);
            });
        }
        
        function selectReason(element, reasonId) {
            // Deseleccionar todos
            document.querySelectorAll('.reason-option').forEach(option => {
                option.classList.remove('selected');
            });
            
            // Seleccionar el actual
            element.classList.add('selected');
            selectedReason = reasonId;
            
            // Habilitar bot√≥n de confirmar
            document.getElementById('confirmReasonBtn').disabled = false;
        }
        
        function confirmReason() {
            if (selectedReason && currentAction) {
                handleResponse(currentAction, selectedReason);
                closeReasonModal();
            }
        }
        
        function closeReasonModal() {
            document.getElementById('reasonModal').style.display = 'none';
            selectedReason = null;
            currentAction = null;
            document.getElementById('confirmReasonBtn').disabled = true;
        }
        
        function handleResponse(action, reason = null) {
            const incidentId = document.getElementById('incidentId').textContent;
            const technicianEmail = new URLSearchParams(window.location.search).get('tecnico') || 'ejemplo@empresa.com';
            
            // Construir la respuesta
            let responseData = {
                action: action,
                incident_id: incidentId,
                technician_email: technicianEmail,
                timestamp: new Date().toISOString()
            };
            
            if (reason) {
                responseData.reason = reason;
            }
            
            // Simular la llamada al webhook
            console.log('Respuesta enviada:', responseData);
            
            // Mostrar confirmaci√≥n
            const actionsDiv = document.querySelector('.actions');
            let message = '';
            let color = '';
            
            switch(action) {
                case 'acepto':
                    message = '‚úÖ Incidencia aceptada. Te hemos asignado como t√©cnico responsable.';
                    color = '#28a745';
                    break;
                case 'rechazo':
                    const rejectReason = rejectReasons.find(r => r.id === reason);
                    message = `‚ùå Respuesta registrada: "${rejectReason?.title}". La incidencia ser√° reasignada.`;
                    color = '#dc3545';
                    break;
                case 'ayuda':
                    const helpReason = helpReasons.find(r => r.id === reason);
                    message = `üÜò Solicitud de ayuda: "${helpReason?.title}". Un supervisor te contactar√°.`;
                    color = '#ffc107';
                    break;
            }
            
            actionsDiv.innerHTML = `
                <div style="text-align: center; color: ${color}; font-weight: 600; padding: 20px; background: ${color}20; border-radius: 12px; grid-column: span 2;">
                    ${message}
                </div>
            `;
        }
        
        // Extraer par√°metros de la URL si vienen del correo
        const urlParams = new URLSearchParams(window.location.search);
        const incidentId = urlParams.get('id');
        const technicianEmail = urlParams.get('tecnico');
        const level = urlParams.get('nivel');
        
        if (incidentId) {
            document.getElementById('incidentId').textContent = incidentId;
        }
    </script>
</body>
</html>
